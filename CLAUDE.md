# Claude AI Context - Concept Albums Repository

## What This Repository Is

A collection of complete concept albums with full musical documentation. Each album is 8-10 thematically connected songs with lyrics, chords, arrangements, and ABC notation files that generate playable MIDI.

## Your Role When Working Here

You help create, complete, and maintain concept albums. This means writing songs that fit together thematically, documenting every musical element, and ensuring all technical notation is valid and generates clean MIDI output.

## File Structure You Must Follow

### Per Song (in numbered directories: `01-song-title/`)

**üî¥ CRITICAL: Single Source of Truth Approach**

```
01-song-title/
    .source/
        song.yaml               ‚Üê YOU WRITE THIS (only this!)
    .generated/
        *.abc                   ‚Üê Generated (don't edit)
        *.mid                   ‚Üê Generated (don't edit)
        midi/*.mid              ‚Üê Generated (for easy DAW import)
        lyrics.yaml             ‚Üê Generated (don't edit)
        chords.yaml             ‚Üê Generated (don't edit)
        structure.yaml          ‚Üê Generated (don't edit)
        sections/*.abc          ‚Üê Generated (don't edit)
    lyrics.txt                  ‚Üê Generated (human-readable)
    chords.txt                  ‚Üê Generated (human-readable)
    arrangement.txt             ‚Üê Generated (human-readable)
    README.md                   ‚Üê Generated documentation
```

**You only edit: `.source/song.yaml`**  
**Everything else is generated by: `python scripts/generate_song.py song-dir/`**

### What Goes in song.yaml

```yaml
song:
  title: "Song Title"
  composer: "Brian Edwards"
  tempo: 88
  time: "4/4"
  key: "Cmin"
  structure: [intro, verse, chorus, verse, chorus, bridge, chorus, outro]

sections:
  verse:
    bars: 8
    lyrics:
      verse1:
        - line: "Lyric line one"
          chords: ["Cm", "F"]
        - line: "Lyric line two"
          chords: ["Bb", "G"]
    instruments:
      vocal-melody:
        abc: |
          "Cm"G2 G2 G2 c2 | "F"c2 c4 A2 |
      bass:
        abc: |
          "Cm"C,2 C,2 G,,2 G,,2 | "F"F,2 F,2 C,2 C,2 |
      # ... etc for each instrument

      drums:
        kick: "C4 C4 | C4 C4 |"
        snare: "z4 E4 | z4 E4 |"
        # Optional: hihat, crash, ride, tom1, tom2, tom3
      # ... etc for each instrument

instruments:
  vocal-melody:
    program: 53
  bass:
    program: 33
  drums:
    percussion: true  # Creates separate MIDI files for each drum part
```

### Per Album (top-level folder)

- `README.md` - Album concept, track listing, recording notes, credits

## ABC Notation: Critical Technical Requirements

You MUST validate ABC files with abc2midi before considering them complete. Here's what you learned:

### Timing Errors Are Your Enemy

**Every bar must equal its time signature exactly.**

In 4/4 time with L:1/8 (eighth note default):
- One bar = 8 eighth notes total
- Can be: `D2 D2 D2 D2` (4 quarters as eighths) = 2+2+2+2 = 8 ‚úì
- Can be: `D4 D4` (2 halves) = 4+4 = 8 ‚úì
- Cannot be: `D2 D2 D2 D2 D2` = 2+2+2+2+2 = 10 ‚úó

**Common mistake pattern you made:**
```abc
"Bb"[D2F2]z "F"[C2F2]z "Gm"[D2G2]z z2
```
This is 2+1+2+1+2+1+2 = 11 eighths. Wrong.

Fixed version:
```abc
"Bb"[D2F2] "F"[C2F2] "Gm"[D2G2] z2
```
This is 2+2+2+2 = 8 eighths. Correct.

### Repeat Markers Don't Work With Multiple Lyric Lines

**What you tried initially:**
```abc
|: "Gm"D2 D2 D2 G2 | "Cm"G2 G4 G2 |
"Bb"F2 F2 F2 F2 | "F"F4 G2 A2 :|
w: First verse lyrics here
w: Second verse lyrics here
```

abc2midi error: "Line of music without lyrics"

**What works:**
Write out each section explicitly with lyrics immediately following:
```abc
"Gm"D2 D2 D2 G2 | "Cm"G2 G4 G2 |
w: First verse ly-rics here
"Bb"F2 F2 F2 F2 | "F"F4 G2 A2 |
w: more first verse ly-rics
"Gm"D2 D2 D2 G2 | "Cm"G2 G4 G2 |
w: Se-cond verse ly-rics here
"Bb"F2 F2 F2 F2 | "F"F4 G2 A2 |
w: more se-cond verse ly-rics
```

### Annotations Break the Parser

**What you tried:**
```abc
"Cm"^"let ring"[C4E4G4] z4
"Bb"^"pm"[D2F2][D2F2]
```

abc2midi error: "Malformed note: expecting a-g or A-G"

**Solution:** Remove all `^"text"` annotations from ABC files. Put performance notes in `arrangement.txt` instead.

### Drum Tracks: Separate Files Per Instrument

**Important:** Drums are now generated as separate ABC/MIDI files for each drum part (kick, snare, hi-hat, etc.) instead of using multi-voice notation.

**All drum parts use C (capital C, MIDI note 60) for single instrument compatibility in DAWs.**

In `song.yaml`, define drums like this:
```yaml
sections:
  verse:
    instruments:
      drums:
        kick: "C4 C4 | C4 C4 |"      # All drums use C (MIDI note 60 = C3 in Bitwig/Ableton)
        snare: "z4 C4 | z4 C4 |"     # All drums use C (MIDI note 60 = C3 in Bitwig/Ableton)
        hihat: "C C C C |"           # All drums use C (MIDI note 60 = C3 in Bitwig/Ableton) - optional
        crash: "C4 z4 |"             # All drums use C (MIDI note 60 = C3 in Bitwig/Ableton) - optional
        ride: "C2 C2 C2 C2 |"        # All drums use C (MIDI note 60 = C3 in Bitwig/Ableton) - optional
```

This generates:
- `.generated/drum-kick.abc` and `drum-kick.mid`
- `.generated/drum-snare.abc` and `drum-snare.mid`
- `.generated/drum-hihat.abc` and `drum-hihat.mid` (if defined)
- etc.

Each drum file is a single-track MIDI file on channel 10 with all notes at MIDI note 60 (displays as **C3** in Bitwig and Ableton due to their off-by-one MIDI naming convention). This allows you to load each drum part as a separate track with a single instrument, where you can assign different samples to each track.

**Available drum parts (all use C in ABC = MIDI note 60 = C3 in your DAW):**
- `kick` - Bass drum
- `snare` - Snare drum
- `hihat` - Hi-hat (optional)
- `crash` - Crash cymbal (optional)
- `ride` - Ride cymbal (optional)
- `tom1` - High tom (optional)
- `tom2` - Mid tom (optional)
- `tom3` - Low tom (optional)

### No Warnings for Drum Files

Drum files use `K:C` (not `K:C perc`) and `%%MIDI channel 10` to generate MIDI note 60 (shows as C3 in Bitwig/Ableton) on the percussion channel. This produces clean MIDI files with no warnings.

**Note naming convention:**
- ABC notation: `C` (capital C in key of C)
- MIDI file: Note 60
- DAW display: **C3** (Bitwig and Ableton use off-by-one convention)
- MIDI Standard name: C4 (middle C)

## THE TOOL-BASED WORKFLOW (USE THIS, NOT MANUAL EDITING)

**üî¥ CRITICAL: Single Source of Truth**

You write **ONE FILE**: `.source/song.yaml`  
Everything else is **GENERATED**: `python scripts/generate_song.py song-dir/`

### Why Single Source?

**Before (error-prone):**
- Edit structure.yaml
- Edit lyrics.yaml (hope it matches)
- Edit chords.yaml (hope it matches lyrics)
- Edit 36 section ABC files (hope bar counts match)
- Edit arrangement.txt (hope it matches everything)
- **Result:** Inconsistencies, copy-paste errors, manual bar counting

**Now (DRY, validated):**
- Edit `.source/song.yaml` (contains everything)
- Run generator
- **Result:** All files guaranteed consistent, validated, correct

### The Complete Workflow (3 Steps)

#### Step 1: Write .source/song.yaml

Create `.source/song.yaml` with ALL song content in one place:

```yaml
song:
  title: "Song Title"
  tempo: 88
  time: "4/4"
  key: "Cmin"
  structure: [intro, verse, chorus]

sections:
  intro:
    bars: 4
    instruments:
      vocal-melody:
        abc: "z8 | z8 | z8 | z8 |"
      bass:
        abc: '"Cm"C,8 | C,8 | C,8 | C,8 |'
  
  verse:
    bars: 8
    lyrics:
      verse1:
        - line: "First line"
          chords: ["Cm", "F"]
    instruments:
      vocal-melody:
        abc: '"Cm"G2 G2 G2 c2 | "F"c2 c4 A2 |'
      bass:
        abc: '"Cm"C,2 C,2 G,,2 G,,2 | "F"F,2 F,2 C,2 C,2 |'

instruments:
  vocal-melody:
    program: 53
  bass:
    program: 33
```

See Song 2's `.source/song.yaml` for complete example.

#### Step 2: Generate Everything

```bash
python scripts/generate_song.py song-directory/
```

This creates:
- `.generated/*.abc` - Complete ABC files (65 bars)
- `.generated/*.mid` - MIDI files
- `.generated/sections/*.abc` - Individual sections
- `.generated/structure.yaml` - Structure definition
- `.generated/lyrics.yaml` - Lyrics only
- `.generated/chords.yaml` - Chords + lyrics
- `lyrics.txt`, `chords.txt`, `arrangement.txt` - Human-readable

**All guaranteed consistent and validated.**

#### Step 3: Verify

```bash
python scripts/abc_tools.py verify song-directory/.generated/
```

Checks all instruments match (they will, by construction).

### Why This Workflow Prevents Errors

1. **Bar counts are defined once** in structure.yaml, enforced everywhere
2. **Templates guarantee correctness** - can't create wrong-sized sections
3. **Validation happens before assembly** - catch errors in small files
4. **Lyrics checked for consistency** - yaml files must match
5. **Scripts are tested** - test suite runs in CI/CD

### DO NOT:

- ‚ùå Manually write complete ABC files
- ‚ùå Edit generated ABC files directly (edit sections instead)
- ‚ùå Count bars yourself (let tools validate)
- ‚ùå Create lyrics.txt and chords.txt without YAML versions
- ‚ùå Skip validation steps

### DO:

- ‚úÖ Use scripts/section_tools.py to generate templates
- ‚úÖ Edit individual section ABC files (small, verifiable)
- ‚úÖ Run validators after every change
- ‚úÖ Keep lyrics.yaml and chords.yaml as source of truth
- ‚úÖ Let build_song.py assemble complete files

## Your Validation Workflow

When you create ABC files:

1. **Count obsessively** - Every bar must add up exactly
2. **Test immediately** - Run `abc2midi file.abc -o file.mid`
3. **Read all warnings** - Don't ignore timing errors
4. **Fix and retest** - Iterate until clean (except perc warning)
5. **Generate MIDI** - Only commit when abc2midi runs clean

## Musical Guidelines for This Project

**Key Family Unity:** Albums stay in one key family. First album is Bb major and its modes (G minor, D dorian, Eb lydian, F mixolydian, Cm aeolian).

**Chord Simplicity:** 3-5 chords per song. Common progressions:
- Bb - Gm - Cm - F
- Dm - Bb - F - Gm  
- Cm - F - Bb - Gm

**Playable Rhythms:** Rock and folk patterns. Driving but not complex. A real band could learn these in rehearsal.

**Section Structure:** Intro, Verse, Chorus, Verse, Chorus, Bridge, Chorus, Outro. Standard rock format.

**Tempo Range:** 88-110 BPM typical. Slower for heavy material, faster for driving songs.

## Arrangement File Format

Be specific. Don't write "drums play a beat." Write:

```
TEMPO: 110 bpm
TIME: 4/4
KEY: G minor

VERSE
Kick: 1 & 3, occasional 1-& doubles
Snare: backbeat 2 & 4
Bass: root-fifth walk (Gm-Cm pattern, quarter notes)
Acoustic: fingerpick pattern (alternating bass, pluck G-Bb-D triad)
Electric: sparse stabs on Cm chord only (let ring)
Organ: silent
```

A session musician should be able to play the part from this description.

## What Makes Good Concept Album Content Here

**Theme First:** Know what the album is about before writing songs. First album: Texas grassroots uprising, liberation theology, working class solidarity.

**Concrete Imagery:** Not abstract political slogans. Specific nouns: mesquite, limestone, Rio Grande, Permian Basin, pink granite, courthouse steps.

**Character Perspective:** Songs speak from a point of view. The foreman's son. The border crossing witness. The worker with grease under their hands.

**Story Arc:** First song opens (Limestone and Fire - awakening). Last song closes (Stone Rolled Away - liberation/resurrection). Middle songs develop the narrative.

**Restraint:** Don't preach. Show through image and story. Let the listener draw conclusions.

## Common Errors You Made (Learn From These)

1. **Bar timing off by one or two eighth notes** - Solution: Count before writing the bar
2. **Using repeat markers with vocal melodies** - Solution: Write out sections explicitly  
3. **Adding too many chords in one bar** - Solution: Spread across multiple bars or simplify
4. **Annotations in ABC files** - Solution: Remove them, use arrangement.txt
5. **Not testing with abc2midi** - Solution: Test every file before committing

## When Creating New Albums

### Initial Concept Development

1. **Establish core vision** - What's the prophetic voice? What injustice needs confronting?
2. **Identify the theological framework** - Which scriptures serve as ammunition?
3. **Map the narrative arc** - Opening awakening ‚Üí confrontation ‚Üí resolution
4. **Define musical palette** - What instruments embody this particular anger/hope?

### The Critical Workflow: Work the Ending First

**Start with song 8, not song 1.** Know where you're going before you begin.

The ending determines everything:
- If song 8 is resurrection, songs 1-7 must build toward death and rebirth
- If song 8 is judgment, songs 1-7 must accumulate evidence
- If song 8 is hope, songs 1-7 must earn that hope through honest confrontation

Write the final song completely (lyrics, chords, arrangement). Then work backwards, asking: "What has to happen for this ending to feel inevitable?"

### Song-by-Song Execution

After establishing the ending:

1. **Write songs in narrative order** - But know the ending informs each earlier song
2. **Complete each song fully** - Lyrics, chords, arrangement, validate ABC, generate MIDI
3. **Test theological precision** - Does every scripture citation land like an accusation?
4. **Check musical coherence** - Does the sound match the fury/hope of the words?
5. **Commit incrementally** - Commit after each song or major revision
6. **Maintain the prophetic edge** - If it feels comfortable, it's wrong

### The Revision Pass

After all songs exist in draft:

1. **Read straight through** - Does the arc work? Does each song earn the next?
2. **Intensify weak spots** - Add scripture. Make accusations more direct.
3. **Check for prettiness** - If anything sounds too polished, roughen it
4. **Test the ending again** - Does song 8 still feel inevitable after songs 1-7?

## Repository Conventions

- **Folder naming:** `album-name/` then `01-song-title/`, `02-next-song/` etc.
- **File naming:** Lowercase, hyphens, no spaces
- **Credits:** Brian Edwards, Jalopy Music, Waco, Texas on all albums
- **Commit both ABC and MIDI** - Source and generated files together

## Success Criteria

A song is complete when:
- All 9-11 files exist
- abc2midi generates MIDI without errors (except ignorable perc warning)
- Arrangement is detailed enough for session musicians
- Lyrics and chords match the theme
- ABC timing is mathematically correct

An album is complete when:
- All songs meet completion criteria
- README documents the concept clearly
- Track order tells a coherent story
- All MIDI files are generated and playable

## Remember

You're not just generating text files. You're creating complete musical documentation that could become real recordings. Precision matters. Validation matters. The constraint of making abc2midi happy makes the work better because it forces you to think like an arranger, not just a lyricist.

Count your eighth notes. Test your work. Make it real.

### Easy DAW Import

All complete song MIDI files are copied to `.generated/midi/` for easy import:

```bash
# To import a song into Bitwig/Ableton:
# Just drag the entire midi/ folder into your DAW

cd stone-gospel-rising/02-blood-on-the-capitol-steps/.generated/midi/
# Contains: bass.mid, drum-kick.mid, drum-snare.mid, guitar-acoustic.mid, etc.
```

Each MIDI file is a single track, ready to load as individual instruments in your DAW.
